language: node_js
node_js:
  - 12.2.0
cache: yarn
services:
  - mongodb
before_script:
  - mongo mydb_test --eval 'use issues-tracker;'
script:
  - yarn test
  - echo $DATABASE_CONNECTION_STRING

deploy:
  matrix:
    - provider: script
      script:
        netlify deploy --site $NETLIFY_SITE_ID --auth $NETLIFY_ACCESS_TOKEN --dir
        ./client/build --prod
      skip_cleanup: true
      on:
        branch: master
    - provider: heroku
      api_key:
        secure: $HEROKU_API_KEY
      app: issuestracker-tb
